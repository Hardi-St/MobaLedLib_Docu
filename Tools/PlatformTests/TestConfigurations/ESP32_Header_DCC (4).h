// This file contains the DCC and LED definitions.
//
// It was automatically generated by the program Prog_Generator_MobaLedLib.xlsm Ver. 3.1.0A      by Hardi
// File creation: 20.12.2021 11:53:44
// (Attention: The display in the Arduino IDE is not updated if Options/External Editor is disabled)

#ifndef __LEDS_AUTOPROG_H__
#define __LEDS_AUTOPROG_H__

#ifndef ARDUINO_RASPBERRY_PI_PICO
#define FASTLED_INTERNAL       // Disable version number message in FastLED library (looks like an error)
#include <FastLED.h>           // The FastLED library must be installed in addition if you got the error message "..fatal error: FastLED.h: No such file or directory"
                               // Arduino IDE: Sketch / Include library / Manage libraries                    Deutsche IDE: Sketch / Bibliothek einbinden / Bibliothek verwalten
                               //              Type "FastLED" in the "Filter your search..." field                          "FastLED" in das "Grenzen Sie ihre Suche ein" Feld eingeben
                               //              Select the entry and click "Install"                                         Gefundenen Eintrag auswaehlen und "Install" anklicken
#else
#include <PicoFastLED.h>       // Juergens minimum version or FastLED for Raspberry Pico
#endif

#include <MobaLedLib.h>

#define START_MSG "LEDs_AutoProg Ver 1: Ver_3.1.0 20.12.21 11:53"

#define TWO_BUTTONS_PER_ADDRESS 1      // Two buttons (Red/Green) are used (DCC/CAN)
#ifdef NUM_LEDS
  #warning "'NUM_LEDS' definition in the main program is replaced by the included 'LEDs_AutoProg.h' with 33"
  #undef NUM_LEDS
#endif

#define NUM_LEDS 33                    // Number of LEDs (Maximal 256 RGB LEDs could be used)

#define LEDS_PER_CHANNEL ",33"

#define RECEIVE_LED_COLOR_PER_RS232
#define USE_EXT_ADDR
#define USE_RS232_OR_SPI_AS_INPUT      // Use the RS232 or SPI Input to read DCC/SX commands from the second Arduino and from the PC (The SPI is only used if enabled with USE_SPI_COM)
#define ADDR_OFFSET 0

#define ADDR_MSK  0x3FFF  // 14 Bits are used for the Address

#define S_ONOFF   (uint16_t)0
#define B_RED     (uint16_t)(1<<14)
#define B_GREEN   (uint16_t)(2<<14)
#define B_RESERVE (uint16_t)(3<<14)    // Not used at the moment
#define B_TAST    B_RED


typedef struct
    {
    uint16_t AddrAndTyp; // Addr range: 0..16383. The upper two bytes are used for the type
    uint8_t  InCnt;
    } __attribute__ ((packed)) Ext_Addr_T;

// Definition of external adressesconst PROGMEM Ext_Addr_T Ext_Addr[] =         { // Addr & Typ    InCnt
           { 1    + S_ONOFF, 1 },      // Excel row 4           { 2    + S_ONOFF, 1 },      // Excel row 6           { 3    + S_ONOFF, 1 },      // Excel row 7           { 4    + S_ONOFF, 1 },      // Excel row 8           { 5    + S_ONOFF, 1 },      // Excel row 9           { 6    + S_ONOFF, 1 },      // Excel row 10           { 7    + S_ONOFF, 1 },      // Excel row 11           { 3002 + B_RED,   1 },      // Excel row 23           { 3003 + B_RED,   1 },      // Excel row 24           { 3004 + B_RED,   1 },      // Excel row 25           { 3005 + B_RED,   1 },      // Excel row 26           { 3006 + B_RED,   1 },      // Excel row 27           { 3007 + B_RED,   1 },      // Excel row 28           { 3008 + B_RED,   1 },      // Excel row 29           { 3009 + B_RED,   1 },      // Excel row 30         };


// Input channel defines for local inputs and expert users
#define INCH_DCC_1_ONOFF        0      // Excel row 4#define INCH_DCC_2_ONOFF        1      // Excel row 6#define INCH_DCC_3_ONOFF        2      // Excel row 7#define INCH_DCC_4_ONOFF        3      // Excel row 8#define INCH_DCC_5_ONOFF        4      // Excel row 9#define INCH_DCC_6_ONOFF        5      // Excel row 10#define INCH_DCC_7_ONOFF        6      // Excel row 11#define INCH_DCC_3002_RED       7      // Excel row 23#define INCH_DCC_3003_RED       8      // Excel row 24#define INCH_DCC_3004_RED       9      // Excel row 25#define INCH_DCC_3005_RED       10     // Excel row 26#define INCH_DCC_3006_RED       11     // Excel row 27#define INCH_DCC_3007_RED       12     // Excel row 28#define INCH_DCC_3008_RED       13     // Excel row 29#define INCH_DCC_3009_RED       14     // Excel row 30// Local InCh variables#define LOC_INCH0               15

//*** Output Channels ***
#define MF1                     16
#define MF2                     17

/*********************/
#define SETUP_FASTLED()                                                      \
/*********************/                                                      \
  CLEDController& controller0 = FastLED.addLeds<NEOPIXEL, 27>(leds+  0, 33); \
                                                                             \
  controller0.clearLeds(256);                                                \
  FastLED.setDither(DISABLE_DITHER);       // avoid sending slightly modified brightness values
/*End*/



//*******************************************************************
// *** Configuration array which defines the behavior of the LEDs ***
MobaLedLib_Configuration()
  {
  RGB_Heartbeat(0)                                                                                            /* Zeigt an, dass die LEDs angesteuert werden                                                                                                                                                  */  Flash(1, C_ALL, 0, LOC_INCH0, 1 Sek, 2 Sek)                                                                 /* Excel row 4                                                                                                                                                                                 */  RGB_Heartbeat(2)                                                                                            /* Excel row 5                                                                                                                                                                                 */  ConstrWarnLightRGB6(3, 1, 5, 255, 100 ms, 0 ms, 500 ms)                                                     /* Excel row 6                                                                                                                                                                                 */  ConstrWarnLightRGB6(9, 2, 5, 255, 100 ms, 0 ms, 500 ms)                                                     /* Excel row 7                                                                                                                                                                                 */  ConstrWarnLightRGB6(15, 3, 5, 255, 100 ms, 0 ms, 500 ms)                                                    /* Excel row 8                                                                                                                                                                                 */  ConstRGB(21, 4, 0, 0, 0, 255, 0, 0)                                                                         /* Excel row 9                                                                                                                                                                                 */  ConstRGB(22, 5, 0, 0, 0, 0, 255, 0)                                                                         /* Excel row 10                                                                                                                                                                                */  ConstRGB(23, 6, 0, 0, 0, 0, 0, 255)                                                                         /* Excel row 11                                                                                                                                                                                */  // Next_LED(-2)                                                                                             /* Excel row 12                                                                                                                                                                                */  MonoFlop(MF1, SI_1, 5 Sek)                                                                                  /* Excel row 13                                                                                                                                                                                */  ConstRGB(22, MF1, 0, 0, 0, 0, 127, 127)                                                                     /* Excel row 14                                                                                                                                                                                */  MonoFlopInv(MF2, SI_1, 30 Sek)                                                                              /* Excel row 15                                                                                                                                                                                */  Const(23, C_ALL, SI_1, 0, 127)                                                                              /* Excel row 16                                                                                                                                                                                */  #define USE_MLL_PLUGINS                                                                                     /* Excel row 18                                                                                                                                                                                */                                                                                                              /*     "                                                                                                                                                                                       */  RGB_Heartbeat_Color(24, 5, 255, 170, 1 Sek)                                                                 /* Excel row 20                                                                                                                                                                                */  #define USE_MLL_PLUGINS                                                                                     /* Excel row 22                                                                                                                                                                                */  ConstRGB(25, 7, 0, 0, 0, 127, 127, 127)                                                                     /* Excel row 23                                                                                                                                                                                */  ConstRGB(26, 8, 0, 0, 0, 127, 127, 127)                                                                     /* Excel row 24                                                                                                                                                                                */  ConstRGB(27, 9, 0, 0, 0, 127, 127, 127)                                                                     /* Excel row 25                                                                                                                                                                                */  ConstRGB(28, 10, 0, 0, 0, 127, 127, 127)                                                                    /* Excel row 26                                                                                                                                                                                */  ConstRGB(29, 11, 0, 0, 0, 127, 127, 127)                                                                    /* Excel row 27                                                                                                                                                                                */  ConstRGB(30, 12, 0, 0, 0, 127, 127, 127)                                                                    /* Excel row 28                                                                                                                                                                                */  ConstRGB(31, 13, 0, 0, 0, 127, 127, 127)                                                                    /* Excel row 29                                                                                                                                                                                */  ConstRGB(32, 14, 0, 0, 0, 127, 127, 127)                                                                    /* Excel row 30                                                                                                                                                                                */  #define COMMANDS_DEBUG                                                                                      /* Excel row 31                                                                                                                                                                                */
  EndCfg // End of the configuration
  };
//*******************************************************************

//---------------------------------------------
void Set_Start_Values(MobaLedLib_C &MobaLedLib)
//---------------------------------------------
{
  MobaLedLib.Set_Input(1, 1);                                                                                 // Excel row 6}


// if function returns TRUE the calling loop stops
typedef bool(*HandleValue_t) (uint8_t CallbackType, uint8_t ValueId, uint8_t* Value, uint16_t EEPromAddr, uint8_t TargetValueId, uint8_t Options);


#define InCnt_MSK  0x0007  // 3 Bits are used for the InCnt
#define IS_COUNTER (uint8_t)0x80
#define IS_PULSE   (uint8_t)0x40
#define IS_TOGGLE  (uint8_t)0x00
#define COUNTER_ID

typedef struct
    {
    uint8_t TypAndInCnt; // Type bit 7, InCnt bits 0..3, reserved 0 bits 4..6
    uint8_t Channel;
    } __attribute__ ((packed)) Store_Channel_T;

// Definition of channels and counters that need to store state in EEPromconst PROGMEM Store_Channel_T Store_Values[] =         { // Mode + InCnt , Channel
           { IS_TOGGLE + 1 , INCH_DCC_1_ONOFF    },      // Excel row 4           { IS_TOGGLE + 1 , INCH_DCC_3_ONOFF    },      // Excel row 7           { IS_TOGGLE + 1 , INCH_DCC_4_ONOFF    },      // Excel row 8           { IS_TOGGLE + 1 , INCH_DCC_5_ONOFF    },      // Excel row 9           { IS_TOGGLE + 1 , INCH_DCC_6_ONOFF    },      // Excel row 10           { IS_TOGGLE + 1 , INCH_DCC_7_ONOFF    },      // Excel row 11         };






#endif // __LEDS_AUTOPROG_H__
